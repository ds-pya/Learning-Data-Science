FROM ubuntu:22.04

# 1. 필수 패키지 설치
RUN apt update && apt install -y \
    wget curl git build-essential software-properties-common \
    python3.10 python3.10-dev python3.10-venv python3-pip \
    gcc g++ cmake libssl-dev

# 2. 심볼릭 링크 설정 (python/pip 명확화)
RUN update-alternatives --install /usr/bin/python python /usr/bin/python3.10 1 && \
    update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 1

# 3. PyTorch + Transformers + Olive + ONNXRuntime 설치
RUN pip install --upgrade pip
RUN pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
RUN pip install transformers peft onnx onnxruntime onnxruntime-genai olive-ai

# 4. (옵션) git clone & build onnxruntime-genai if modifying source
# RUN git clone https://github.com/microsoft/onnxruntime-genai.git /opt/onnxruntime-genai
# RUN cd /opt/onnxruntime-genai && python build.py --config Release

# 5. 작업 디렉토리 설정
WORKDIR /workspace
COPY . /workspace

CMD ["/bin/bash"]