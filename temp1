// lib/services/calbak_event_channel.dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';

import 'package:your_app/app/ui/page/calbak_page.dart'; 
// 또는 CalendarEventDialog 가 정의된 곳

class CalbakEventChannel {
  static const _channel = MethodChannel('calbak_event');
  static GlobalKey<NavigatorState>? _navigatorKey;

  static void init(GlobalKey<NavigatorState> navigatorKey) {
    _navigatorKey = navigatorKey;

    _channel.setMethodCallHandler((call) async {
      if (call.method == 'showEventDialog') {
        final args = Map<String, dynamic>.from(call.arguments as Map);

        final title = args['title'] as String?;
        final location = args['location'] as String?;
        final startIso = args['start_time'] as String?;
        final endIso = args['end_time'] as String?;

        final start =
            (startIso != null && startIso.isNotEmpty) ? DateTime.parse(startIso) : null;
        final end =
            (endIso != null && endIso.isNotEmpty) ? DateTime.parse(endIso) : null;

        final ctx = _navigatorKey?.currentContext;
        if (ctx == null) return;

        _showCalendarEventDialogFromNative(
          ctx: ctx,
          title: title,
          location: location,
          start: start,
          end: end,
        );
      }
    });
  }

  static void _showCalendarEventDialogFromNative({
    required BuildContext ctx,
    String? title,
    String? location,
    DateTime? start,
    DateTime? end,
  }) {
    showDialog(
      context: ctx,
      builder: (context) {
        return CalendarEventDialog(
          eventTitle: title,
          eventLocation: location,
          startTime: start,
          endTime: end,
          onConfirm: (/* Event 혹은 값 */) {
            // 기존 onConfirm 로직 그대로 넣으시면 됩니다.
          },
        );
      },
    );
  }
}