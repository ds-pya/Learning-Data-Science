// android/app/src/main/kotlin/.../MyAssistSession.kt
package com.yourpackage

import android.graphics.Bitmap
import android.os.Bundle
import android.service.voice.VoiceInteractionSession
import io.flutter.embedding.engine.FlutterEngine
import io.flutter.plugin.common.MethodChannel

class MyAssistSession(context: Context) : VoiceInteractionSession(context) {

    override fun onCreate() {
        super.onCreate()
        // 세션 초기화 로직 (필요시)
    }

    override fun onHandleScreenshot(screenshot: Bitmap?) {
        super.onHandleScreenshot(screenshot)

        if (screenshot == null) return

        // 1) Bitmap → 파일 or byte[] 로 저장
        val path = saveScreenshotToCache(screenshot)

        // 2) Flutter 쪽으로 알림
        sendScreenshotToFlutter(path)

        // 3) 필요하면 여기서 바로 UI 띄워도 됨 (setContentView 등)
    }

    private fun saveScreenshotToCache(bitmap: Bitmap): String {
        // cache 디렉토리에 PNG로 저장하고 파일 경로를 리턴 (구현은 생략)
        return "/path/to/file.png"
    }

    private fun sendScreenshotToFlutter(path: String) {
        // FlutterEngine 접근 방식은 프로젝트 구조에 따라 달라짐
        val engine: FlutterEngine = MyFlutterHolder.engine
        val channel = MethodChannel(
            engine.dartExecutor.binaryMessenger,
            "assistant_channel"
        )
        channel.invokeMethod("onScreenshot", path)
    }
}