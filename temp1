package com.example.lockguide.ui

import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.example.lockguide.R

@Composable
fun GuideScreen(
    onChoice: (Choice) -> Unit,
    onDismiss: () -> Unit
) {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .background(Color.Black.copy(alpha = 0.35f))
            .padding(16.dp)
    ) {
        Text(
            text = "ë‹«ê¸°",
            color = Color.White.copy(alpha = 0.85f),
            modifier = Modifier
                .align(Alignment.TopEnd)
                .clickable { onDismiss() }
                .padding(8.dp)
        )

        Column(
            modifier = Modifier.align(Alignment.BottomCenter),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            SpeechBubble(
                text = "ê°•ë‚¨ì—­ 18:00 ì•½ì†!\nì§€ê¸ˆ ì¶œë°œí•˜ë©´ 35ë¶„ ì •ë„ì•¼.\nì–´ë–»ê²Œ ê°ˆê¹Œ?"
            )

            Spacer(Modifier.height(12.dp))

            Image(
                painter = painterResource(id = R.drawable.dog_placeholder),
                contentDescription = "guide dog",
                modifier = Modifier.size(160.dp)
            )

            Spacer(Modifier.height(12.dp))

            Row(horizontalArrangement = Arrangement.spacedBy(10.dp)) {
                ChoiceButton("ðŸš— ìžë™ì°¨") { onChoice(Choice.CAR) }
                ChoiceButton("ðŸš‡ ëŒ€ì¤‘êµí†µ") { onChoice(Choice.TRANSIT) }
                ChoiceButton("ðŸš• íƒì‹œ") { onChoice(Choice.TAXI) }
            }

            Spacer(Modifier.height(18.dp))
        }
    }
}

@Composable
private fun SpeechBubble(text: String) {
    Box(
        modifier = Modifier
            .clip(RoundedCornerShape(18.dp))
            .background(Color.White)
            .padding(horizontal = 14.dp, vertical = 12.dp)
    ) {
        Text(text = text, color = Color.Black, fontSize = 15.sp)
    }
}

@Composable
private fun ChoiceButton(label: String, onClick: () -> Unit) {
    Box(
        modifier = Modifier
            .clip(RoundedCornerShape(16.dp))
            .background(Color.White.copy(alpha = 0.92f))
            .clickable { onClick() }
            .padding(horizontal = 12.dp, vertical = 10.dp)
    ) {
        Text(label, color = Color.Black, fontSize = 14.sp)
    }
}