private fun onSaveEventClicked() {
    val rawTitle = etTitle.text?.toString()?.trim()
    val rawLocation = etLocation.text?.toString()?.trim()
    val rawStartIso = etStartTime.text?.toString()?.trim()
    val rawEndIso = etEndTime.text?.toString()?.trim()

    val title = rawTitle.takeIf { !it.isNullOrEmpty() }
    val location = rawLocation.takeIf { !it.isNullOrEmpty() }

    assistScope.launch {
        // 1) 캘린더 ID 찾기
        val calendarId = CalbakCalendarRepository.findDefaultCalendarId(context)
        if (calendarId == null) {
            Log.e("CalbakAssistSession", "No default calendar found")
            withContext(Dispatchers.Main) {
                Toast.makeText(context, "사용 가능한 캘린더를 찾을 수 없습니다.", Toast.LENGTH_SHORT).show()
            }
            return@launch
        }

        // 2) 시간 파싱 (파싱 실패하면 now / +1h)
        val now = System.currentTimeMillis()
        val startMillis = parseIsoToMillisOrNull(rawStartIso) ?: now
        val endMillis = parseIsoToMillisOrNull(rawEndIso) ?: (startMillis + 60 * 60 * 1000L)

        // 3) 이벤트 등록
        val eventId = CalbakCalendarRepository.insertEventWithReminder(
            context = context,
            calendarId = calendarId,
            title = title ?: "제목 없음",
            location = location,
            description = "Generated by CalBak",
            startMillis = startMillis,
            endMillis = endMillis,
            reminderMinutes = 1440
        )

        withContext(Dispatchers.Main) {
            if (eventId != null) {
                Toast.makeText(context, "일정이 등록되었습니다.", Toast.LENGTH_SHORT).show()
            } else {
                Toast.makeText(context, "일정 등록에 실패했습니다.", Toast.LENGTH_SHORT).show()
            }
            // 세션 종료 → 원래 웹/앱 화면으로 복귀
            finish()
        }
    }
}